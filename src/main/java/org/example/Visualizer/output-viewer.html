<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>PlateOptimizer - Output Viewer</title>
</head>
<body>
    <h1>PlateOptimizer Output Viewer</h1>
    
    <p>
        JSON-Datei laden: 
        <input type="file" id="fileInput" accept=".json">
    </p>
    
    <hr>
    
    <p>
        BMP-Datei laden: 
        <input type="file" id="bmpInput" accept=".bmp" multiple>
    </p>

    <div id="bmpContent">
        <!-- BMP Vorschau erscheint hier -->
    </div>

    <hr>

    <div id="content">
        Keine Daten geladen.
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        displayData(data);
                    } catch (error) {
                        alert('Fehler: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        function displayData(data) {
            let html = '<h2>Lösung: ' + (data.solutionName || '-') + '</h2>';
            html += '<p>Zeitstempel: ' + (data.timestamp || '-') + '</p>';
            html += '<p>Anzahl Platten: ' + (data.plates ? data.plates.length : 0) + '</p>';
            html += '<hr>';

            if (data.plates) {
                data.plates.forEach((plate, index) => {
                    html += '<h3>Platte ' + (index + 1) + ': ' + plate.name + '</h3>';
                    html += '<p>Dimensionen: ' + plate.width + ' x ' + plate.height + ' mm</p>';
                    
                    html += '<h4>Schnitte (' + (plate.cuts ? plate.cuts.length : 0) + ')</h4>';
                    if (plate.cuts && plate.cuts.length > 0) {
                        html += '<table border="1" cellpadding="5" cellspacing="0">';
                        html += '<tr><th>ID</th><th>Typ</th><th>Start (x,y)</th><th>Ende (x,y)</th></tr>';
                        plate.cuts.forEach(cut => {
                            html += '<tr>';
                            html += '<td>C' + cut.id + '</td>';
                            html += '<td>' + (cut.type === 'V' ? 'Vertikal' : 'Horizontal') + '</td>';
                            html += '<td>(' + cut.x1 + ', ' + cut.y1 + ')</td>';
                            html += '<td>(' + cut.x2 + ', ' + cut.y2 + ')</td>';
                            html += '</tr>';
                        });
                        html += '</table>';
                    } else {
                        html += '<p><em>Keine Schnitte</em></p>';
                    }

                    html += '<h4>Restplatten (' + (plate.leftoverPlates ? plate.leftoverPlates.length : 0) + ')</h4>';
                    if (plate.leftoverPlates && plate.leftoverPlates.length > 0) {
                        html += '<table border="1" cellpadding="5" cellspacing="0">';
                        html += '<tr><th>ID</th><th>Breite x Höhe</th><th>Position X</th><th>Position Y</th><th>Jobs</th></tr>';
                        plate.leftoverPlates.forEach(lp => {
                            html += '<tr>';
                            html += '<td>R' + lp.id + '</td>';
                            html += '<td>' + lp.width + ' x ' + lp.height + ' mm</td>';
                            html += '<td>' + lp.x0 + ' - ' + lp.x1 + '</td>';
                            html += '<td>' + lp.y0 + ' - ' + lp.y1 + '</td>';
                            html += '<td>' + lp.jobCount + '</td>';
                            html += '</tr>';
                        });
                        html += '</table>';
                    } else {
                        html += '<p><em>Keine Restplatten</em></p>';
                    }
                    
                    html += '<hr>';
                });
            }

            document.getElementById('content').innerHTML = html;
        }

        // BMP-Dateien einlesen und anzeigen
        document.getElementById('bmpInput').addEventListener('change', function (e) {
            const files = Array.from(e.target.files || []);
            if (files.length === 0) return;

            let html = '<h2>BMP Vorschau (' + files.length + ')</h2>';
            files.forEach((file, idx) => {
                const url = URL.createObjectURL(file);
                html += '<div style="margin:8px 0">';
                html += '<div><strong>Datei ' + (idx + 1) + ':</strong> ' + (file.name || '') + '</div>';
                html += '<img src="' + url + '" alt="BMP ' + (idx + 1) + '" style="max-width:100%;border:1px solid #ccc;">';
                html += '</div>';
            });
            document.getElementById('bmpContent').innerHTML = html;
        });
    </script>
</body>
</html>
